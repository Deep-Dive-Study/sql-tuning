# 5.1 소트 연산에 대한 이해

소트는 PGA의 Sort Area에서 이루어진다. (꽉차면 Temp 테이블스페이스)

- 메모리 소트 : 전체 데이터 정렬 작업을 메모리 내에서 완료하는 것 (Internal Sort)
- 디스크 소트 : Sort Area 내에서 완료하지 못해 디스크 공간까지 활용하는 경우 (External Sort)

![image](https://github.com/user-attachments/assets/a2fe7abb-27ff-4697-a4d0-8d53287d972d)

1. SGA 버퍼캐시를 통해 소트할 대상 집합을 읽어들인다.
2. PGA의 Sort Area에서 정렬을 시도하고, 공간이 부족하면 Temp 세그먼트 단위로 테이블스페이스를 사용한다.
3. 세그먼트별 정렬 후 Merge 하여 PGA에서 클라이언트로 전송한다.

소트 연산은 메모리/CPU 직약접이어서 처리할 데이터량이 많을 때는 디스크 I/O 까지 발생하므로 쿼리 성능을 좌우한다.

**부분범위 처리를 불가**능하게 함으로써 OLTP 환경에서 애플리케이션 성능을 저하시키는 주요인이 된다.

- 소트가 발생하지 않으면 좋다.
- 소트가 발생하면 메모리 내에서 수행하도록 하면 좋다.

## 5.1.2 소트 오퍼레이션

### 1. Sort Aggregate

- 전체 로우를 대상으로 집계를 수행한다.
- 실제 정렬이 일어나진 않는다.
- Sort Area를 사용한다.

Sort Aggregate 절차

1. SUM, MAX, MIN, COUNT 값을 위한 변수를 하나씩 할당한다.
2. 레코드에서 읽은 값을 각각 변수에 저장한다.
3. 레코드를 읽어가며 해당 변수에 맞게 값을 변경한다.
4. 레코드를 전부 읽고 나서 각 변수에 남은 값을 출력한다.

### 2. Sort Order By

- 데이터를 정렬할 때 나타난다.

### 3. Sort Group By

- 소팅 알고리즘을 사용해 그룹별 집계를 수행할 때 나타난다.
- Group 별로 따로 변수를 선언해 Sort Aggregate 방식처럼 레코드를 모두 읽고 갱신한다.
- Group의 수가 많지 않다면 Sort Area가 클 필요가 전혀 없다.

Hash Group By

- 오라클 10gR2 버전에 도입
- Group By 뒤에 Order By 절을 명시하지 않으면 대부분 Hash Group By로 처리한다.
- 9i부터 그루핑 결과는 정렬 순서를 보장하지 않는다.
    - 오라클은 물리적인 정렬 순서로 읽기 때문이다.
    - 정렬된 순서를 얻고자 한다면 반드시 Order By를 명시하자

### 4. Sort Unique

- 서브쿼리를 풀어 Unnesting할 때 메인 쿼리와의 중복 코드를 제거하는 것
- 서브쿼리의 조인 컬럼에 Unique 인덱스가 없으면 Sort Unique 오퍼레이션이 나타난다.
- PK/Unique 제약 또는 Unique 인덱스를 통해 Unnesting된 서브쿼리의 유일성이 보장되면 Sort Unique는 생략된다.
- Union, Minus, Interest, Distinct 와 같은 연산자를 사용할 때도 다음 오퍼레이션이 나타난다.
    - Distinct 연산에도 Hash Unique 방식을 사용한다.

### 5. Sort Join

- 소트 머지조인을수행할 때 나타난다.

### 6. Window Sort

- 윈도우 함수를 수행할 때 나타난다.
